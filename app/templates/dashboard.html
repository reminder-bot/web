<!DOCTYPE html>
<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124883353-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-124883353-1');
        </script>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Reminder Bot - Dashboard</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
        <!-- Theme style -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/AdminLTE.min.css') }}">
        <!-- AdminLTE Skins. Choose a skin from the css/skins
            folder instead of downloading all of them to reduce the load. -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/_all-skins.min.css') }}">
        <!-- Date Picker -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-datepicker.min.css') }}">
        <!-- Bootstrap time Picker -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-timepicker.min.css') }}">

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <script src="{{ url_for('static', filename='js/moment.min.js') }}"></script>
        <!-- datepicker -->
        <script src="{{ url_for('static', filename='js/bootstrap-datepicker.min.js') }}"></script>
        <!-- bootstrap time picker -->
        <script src="{{ url_for('static', filename='js/bootstrap-timepicker.min.js') }}"></script>

        <!-- HTML5 Shim and Respond.js') }} IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js') }} doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <!-- Google Font -->

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    </head>

    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="{{ url_for('help') }}" class="logo">
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>Reminder</b>BOT</span>
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-top">
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- Messages: style can be found in dropdown.less-->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span class="hidden-xs">{{ user['username'] }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <p>
                                        {{ user['username'] }}
                                    </p>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">
                <!-- sidebar menu: : style can be found in sidebar.less -->
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="header">GUILDS</li>
                    {% for guild in guilds %}
                        <li style="margin-left: 2rem;"><a href="{{ url_for('dashboard', id=guild['id']) }}">{{ guild['name'] }}</a></li>
                    {% endfor %}
                </ul>
            </section>
            <!-- /.sidebar -->
        </aside>
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-danger alert-dismissable">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% if server %}
            <section class="content-header">
                <h1>
                    Dashboard
                    <small>Reminders</small>
                </h1>
            </section>

            <section class="content">
                <div class="box">
                    <div class="box-body">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Message</th>
                                    <th>Time</th>
                                    <th>Channel</th>
                                    <th>Interval</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reminder in reminders %}
                                    <tr>
                                        <td>{{ reminder['message'] }}</td>
                                        <td id="time_val_{{ reminder['index'] }}">{{ reminder['time'] }}</td>
                                        <script>

document.getElementById('time_val_' + {{ reminder['index'] }}).innerHTML = moment.unix({{ reminder['time'] }}).calendar();

                                        </script>
                                        <td>#{{ reminder['channel']['name'] }}</td>
                                        <td>{{ reminder['interval'] }}</td>
                                        <td>
                                            <button onclick="send_delete('{{ reminder['index'] }}')" class="guildbtn btn btn-danger btn-fill"><i class="fa fa-times"></i></button>
                                            <button data-toggle="modal" data-target="#editModal{{ reminder['index'] }}" class="guildbtn btn btn-info btn-fill"><i class="fa fa-pencil"></i></button>
                                            <div class="modal fade col-md-12" id="editModal{{ reminder['index'] }}" data-backdrop="false">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <form method="POST">
                                                            <div class="modal-header">
                                                                <h4>Edit Reminder</h4>
                                                            </div>
                                                            <div class="modal-body">
                                                                <!-- MESSAGE -->
                                                                <div class="form-group">
                                                                    <label>Message:</label>
                                                                    <div class="input-group">
                                                                        <div class="input-group-addon">
                                                                            <i class="fa fa-envelope"></i>
                                                                        </div>
                                                                        <input type="text" name="message_{{ reminder['index'] }}" class="form-control pull-right" value="{{ reminder['message'] }}">
                                                                    </div>
                                                                    <!-- /.input group -->
                                                                </div>
                                                                <!-- CHANNEL -->
                                                                <div class="form-group">
                                                                    <label>Channel:</label>
                                                                    <div class="input-group">
                                                                        <div class="input-group-addon">
                                                                            <i class="fa fa-users"></i>
                                                                        </div>
                                                                        <input type="text" name="channel_{{ reminder['index'] }}" id="input-channel-{{ reminder['index'] }}" value="{{ reminder['channel']['id'] }}" hidden>
                                                                        <div class="dropdown">
                                                                            <button class="btn btn-default dropdown-toggle" type="button" id="dropdown-channel-{{ reminder['index'] }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                                                {{ reminder['channel']['name'] }}
                                                                                <span class="caret"></span>
                                                                            </button>
                                                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                                                                {% for channel in channels %}
                                                                                    <li><a onclick="javascript:change_channel('{{ channel['id'] }}', '{{ channel['name'] }}', {{ reminder['index'] }})">{{ channel['name'] }}</a></li>
                                                                                {% endfor %}
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                    <!-- /.input group -->
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="submit" class="btn btn-success">Submit</button>
                                                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                    <!-- Bottom Divider -->
                            </tbody>
                        </table>
                        <div class="text-center">
                            <hr>
                            <button data-toggle="modal" data-target="#addModal" class="guildbtn btn btn-success btn-fill">Add Reminder</button>
                            <button data-toggle="modal" data-target="#addModal2" class="guildbtn btn btn-primary btn-fill">Edit Server Settings</button>
                        </div>
                    </div>
                </div>
                <!-- BLOCK CONTENT -->
                <div class="modal fade col-md-12" id="addModal" data-backdrop="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form method="post">
                                <div class="modal-header">
                                    <h4>Add Reminder</h4>
                                </div>
                                <div class="modal-body">
                                    <!-- MESSAGE -->
                                    <div class="form-group">
                                        <label>Message:</label>
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-envelope"></i>
                                            </div>
                                            <input type="text" name="message_new" class="form-control pull-right">
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <!-- CHANNEL -->
                                    <div class="form-group">
                                        <label>Channel:</label>
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-users"></i>
                                            </div>
                                            <input type="text" name="channel_new" id="input-channel" hidden>
                                            <div class="dropdown">
                                                <button class="btn btn-default dropdown-toggle" type="button" id="dropdown-channel" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    Select One
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                                    {% for channel in channels %}
                                                        <li><a onclick="javascript:change_channel('{{ channel['id'] }}', '{{ channel['name'] }}')">{{ channel['name'] }}</a></li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <!-- DATE -->
                                    <input name="time_new" value="0" id="time_new" hidden></input>
                                    <div class="form-group">
                                        <label>Date:</label>
                                        <div class="input-group date">
                                            <div class="input-group-addon">
                                                <i class="fa fa-calendar"></i>
                                            </div>
                                            <input type="text" class="form-control pull-right" id="datepicker" name="date"></input>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <!-- TIME -->
                                    <div class="bootstrap-timepicker">
                                        <div class="form-group">
                                            <label>Time picker:</label>
                                            <div class="input-group">
                                                <div class="input-group-addon">
                                                    <i class="fa fa-clock-o"></i>
                                                </div>
                                                <input type="text" class="form-control timepicker" id="timepicker" name="time"></input>
                                            </div>
                                            <!-- /.input group -->
                                        </div>
                                        <!-- /.form group -->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">Submit</button>
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- BLOCK CONTENT -->
                <div class="modal fade col-md-12" id="addModal2" data-backdrop="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form method="post">
                                <input name="update-server" hidden></input>

                                <div class="modal-header">
                                    <h4>Edit Server Settings</h4>
                                </div>
                                <div class="modal-body">
                                    <!-- MESSAGE -->
                                    <div class="form-group">
                                        <label>Prefix:</label>
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-exclamation-circle"></i>
                                            </div>
                                            <input type="text" name="prefix" class="form-control pull-right" value="{{ server.prefix }}" maxlength="5">
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <!-- CHANNEL -->
                                    <div class="form-group">
                                        <label>Timezone:</label>
                                        <div class="input-group">
                                            <div class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </div>
                                            <input type="text" name="timezone" id="timezone" hidden>
                                            <div class="dropdown">
                                                <button class="btn btn-default dropdown-toggle" type="button" id="dropdown-timezone" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    {{ server.timezone }}
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" style="max-height: 40vh; overflow-y: scroll;">
                                                    {% for tz in timezones %}
                                                        <li><a onclick="javascript:change_tz('{{ tz[1] }}')">{{ tz[1] }} (GMT {{ tz[0] }})</a></li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <!-- /.input group -->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-success">Submit</button>
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            {% else %}
            <p class="lead" style="margin-left: 5vw;">Please select a guild from the sidebar</p>
            {% endif %}

            <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->
            <footer class="main-footer">
                <div class="pull-right hidden-xs">
                    <b
                </div>
                <strong>Copyright &copy; 2018 <a href="https://github.com/reminder-bot">JellyWX</a>.</strong> All rights
                reserved.
            </footer>
        </div>

        <script>
//Date picker
$('#datepicker').datepicker({
    format: 'yyyy/mm/dd',
    autoclose: true
})
//Timepicker
$('.timepicker').timepicker({
    minuteStep: 1,
    showInputs: false,
    showSeconds: true
})

$("#datepicker").change(update_time);
$("#timepicker").change(update_time);

function update_time()
{
    t_time = document.getElementById("timepicker");
    d_time = document.getElementById("datepicker");

    m = moment(d_time.value + ' ' + t_time.value, 'YYYY/MM/DD HH:mm:ss A')

    document.getElementById("time_new").value = m.unix();
}

function change_channel(id, name, index)
{

    if (index === undefined)
    {
        document.getElementById('input-channel').value = id;
        document.getElementById('dropdown-channel').innerHTML = name + "<span class=\"caret\"></span>";
    }
    else
    {
        document.getElementById('input-channel-' + index).value = id;
        document.getElementById('dropdown-channel-' + index).innerHTML = name + "<span class=\"caret\"></span>";
    }
}

function change_tz(timezone)
{
    document.getElementById('timezone').value = timezone;
    document.getElementById('dropdown-timezone').innerHTML = timezone + "<span class=\"caret\"></span>"
}

function send_delete(index)
{
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            location.reload(true);
        }
    };
    xhttp.open("GET", "{{ url_for('delete') }}" + "?index=" + index, true);
    xhttp.send();
}

        </script>
    </body>
</html>
